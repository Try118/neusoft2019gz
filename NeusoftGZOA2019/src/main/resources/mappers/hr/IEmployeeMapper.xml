<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<!-- 用户DAO接口Mapping映射 --> 
<mapper namespace="com.neusoft.oa.hr.mapper.IEmployeeMapper">
  
  <cache/>
  <resultMap id="EmployeeResultMap" type="Employee">
      <id property="id" column="EMPID"/>
      <result property="password" column="EMPPASSWORD"/>
      <result property="name" column="EMPName"/>
      <result property="sex" column="EMPSEX"/>
      <result property="age" column="AGE"/>
      <result property="salary" column="SALARY"/>
      <result property="birthday" column="BIRTHDAY"/>
      <result property="joinDate" column="JOINDATE"/>
      <result property="photo" column="PHOTO"/>
      <result property="photoFileName" column="photoFileName"/>
      <result property="photoContentType" column="photoContentType"/>
      <result property="mail" column="MAIL"/>
      
  </resultMap>
  <!-- 关联的部门的ResultMap -->
  <resultMap  id="EmployeeWithDepartmentResultMap" type="Employee" extends="EmployeeResultMap">
  	<association property="department" resultMap="com.neusoft.oa.hr.mapper.IDepartmentMapper.DepartmentResultMap"></association>
  </resultMap>
  <!-- 关联的爱好的ResultMap -->
  <resultMap  id="EmployeeWithBehaveResultMap" type="Employee" extends="EmployeeResultMap">
  	<collection property="behaves" resultMap="com.neusoft.oa.hr.mapper.IBehaveMapper.BehaveResultMap"></collection>
  </resultMap>
  <!-- 关联部门和爱好 -->
  <resultMap  id="EmployeeWithDepartmentBehavesResultMap" type="Employee" extends="EmployeeResultMap">
  	<association property="department" resultMap="com.neusoft.oa.hr.mapper.IDepartmentMapper.DepartmentResultMap"></association>
  	<collection property="behaves" resultMap="com.neusoft.oa.hr.mapper.IBehaveMapper.BehaveResultMap"></collection>
  </resultMap>
  <!-- 无图片增加 -->
  <insert id="insert"  parameterType="Employee" flushCache="true">
   insert into oa_employee (EMPUSERID,EMPUSERPASSWORD,EMPUSERNAME,EMPSEX,AGE,SALARY,Birthday,JOINDATE,Mail)
   values (#{id},#{password},#{name},#{sex},#{age},#{salary},#{birthday},#{joinDate},#{mail})
  <!-- 有图片增加 -->
  </insert>
  <insert id="createWithPhoto"  parameterType="Employee" flushCache="true">
   insert into oa_employee (EMPUSERID,EMPUSERPASSWORD,EMPUSERNAME,EMPSEX,AGE,SALARY,Birthday,JOINDATE,Mail,PHOTO,PHOTOFILENAME,PHOTOCONTENTTYPE)
   values (#{id},#{password},#{name},#{sex},#{age},#{salary},#{birthday},#{joinDate},#{mail},#{photo},#{photoFileName},#{photoContentType})
  
  </insert>
  <!-- 无图片修改 -->
  <update id="update" flushCache="true">
   update oa_employee set EMPPassword=#{password},EMPName=#{name},EMPSEX=#{sex},age=#{age},salary=#{salary}
   ,Birthday=#{birthday},JoinDate=#{joinDate},MAIL=#{mail} 
   where USERID=#{id}
  </update>
  <!-- 有图片修改 -->
  <update id="updateWithPhoto" flushCache="true">
   update oa_employee set EMPPassword=#{password},EMPName=#{name},EMPSEX=#{sex},age=#{age},salary=#{salary}
   ,Birthday=#{birthday},JoinDate=#{joinDate},MAIL=#{mail},PHOTO=#{photo},photoFileName=#{photoFileName},photoContentType=#{photoContentType}
   where EMPID=#{id}
  </update>
  
  <update id="pdateForDeletePhoto">
  update oa_employee set PHOTO=null,photoFileName=null,photoContentType=null where EMPID=#{id}
  </update>
 
  
  <delete id="delete" flushCache="true">
   delete from oa_employee where  EMPID=#{id}
  </delete>
  
  <select id="selectByIdWithDepartmentAndBehaves" resultMap="EmployeeWithDepartmentBehavesResultMap" >
  select a.*,d.* from oa_employee a inner join oa_department b on a.DEPTNO=b.DEPTNO
  left outer join oa_employeebehave c on a.EMPID=c.EMPID 
  left outer join oa_behave d on c.BNO=d.BNO 
   where a.EMPID=#{id}  
  </select>
  
   <!-- 取得所有员工列表，不取关联的部门对象，不取关联的爱好集合,不分页模式 -->
  <select id="selectListByAllWithoutDepartmentAndBehaves" resultMap="EmployeeResultMap">
   select EMPUSERID,EMPUSERPASSWORD,EMPUSERNAME,EMPSEX,AGE,SALARY,Birthday,JOINDATE,Mail,PHOTOFILENAME,PHOTOCONTENTTYPE from oa_employee
  
  </select>
  <!-- 取得所有员工列表，不取关联的部门对象，不取关联的爱好集合,分页模式 -->
  <select id="selectListByAllWithoutDepartmentAndBehavesWithPage" resultMap="EmployeeResultMap">
   select EMPUSERID,EMPUSERPASSWORD,EMPUSERNAME,EMPSEX,AGE,SALARY,Birthday,JOINDATE,Mail,PHOTOFILENAME,PHOTOCONTENTTYPE from oa_employee
   limit #{start},#{rows}
  </select>
  <!-- 取得所有员工列表，同时取关联的部门对象，不取关联的爱好集合 -->
  <select id="selectListByAllWithDepartmentWithoutBehaves" resultMap="EmployeeWithDepartmentResultMap">
  select a.*,b.* from oa_employee a inner join oa_department b on a.DEPTNO=b.DEPTNO
  </select>
  <!-- 根据综合检索条件取得员工列表，取得关联的部门，不取关联的爱好列表，分页模式 -->
  <select id="selectListByConditionWithDepartmentNoAndBehavesWithPage" resultMap="EmployeeWithDepartmentResultMap">
  select a.*,b.* from oa_employee a inner join oa_department b on a.DEPTNO=b.DEPTNO
  <where>
     <if test="departmentNo!=0">
      and a.DEPTNO=#{departmentNo}
     </if>
     <if test="behaveNo!=0">
     and a.EMPID in (select EMPID from oa_employeebehave where BNO=#{behaveNo})
     </if>
     <if test="sex!=null and sex!=''">
     and a.EMPSEX=#{sex}
     </if>
     <if test="startJoinDate!=null">
     and a.JOINDATE  &gt;=#{startJoinDate}
     </if>
     <if test="endJoinDate!=null">
     and a.JOINDATE &lt;=#{endJoinDate}
     </if>
  </where>
    limit #{start},#{rows}
  </select>
  
  <!-- 根据综合检索条件取得员工个数-->
  <select id="selectCountByCondition" resultType="int">
  select select IFNULL(count(EMPID), 0) from oa_employee 
  <where>
     <if test="departmentNo!=0">
      and a.DEPTNO=#{departmentNo}
     </if>
     <if test="behaveNo!=0">
     and a.EMPID in (select EMPID from oa_employeebehave where BNO=#{behaveNo})
     </if>
     <if test="sex!=null and sex!=''">
     and a.EMPSEX=#{sex}
     </if>
     <if test="startJoinDate!=null">
     and a.JOINDATE  &gt;=#{startJoinDate}
     </if>
     <if test="endJoinDate!=null">
     and a.JOINDATE &lt;=#{endJoinDate}
     </if>
  </where>
   
  </select>
  

  <!-- 为员工一次增加多个角色 -->
  <insert id="addBehaves">
    insert into oa_employeebehave (EMPID,BNO) values 
    <foreach  item="behaveNo" collection="behaves"   separator="," >
          (#{id},#{behaveNo)
    </foreach>
   </insert>
   
   <!-- 删除指定员工的所有爱好 -->
   <delete id="deleteBehaves" >
   delete from oa_employeebehave where EMPID=#{id}
   </delete>
  
  
</mapper>